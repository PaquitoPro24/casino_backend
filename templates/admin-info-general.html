<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Información General — Royal Crumbs</title>
  <link rel="stylesheet" href="{{ url_for('static', path='css/admin-info-general.css') }}">
  <script src="{{ url_for('static', path='js/admin-auth.js') }}"></script>
</head>

<body>
  <div class="rc-container">

    <!-- ===== ENCABEZADO ===== -->
    <header class="rc-header">
      <a href="/admin" class="rc-back">‹</a>
      <h1 class="rc-screen-title">Información General</h1>
      <div></div>
    </header>

    <!-- ===== TARJETAS DE MÉTRICAS ===== -->
    <section class="metrics-section">
      <div class="metrics-grid">
        <div class="metric-card">
          <h3>Usuarios Totales</h3>
          <p class="value">-</p>
          <span class="percent green">+5%</span>
        </div>

        <div class="metric-card">
          <h3>Usuarios Activos</h3>
          <p class="value">-</p>
          <span class="percent green">-</span>
        </div>

        <div class="metric-card">
          <h3>Depósitos Hoy</h3>
          <p class="value">$0.00</p>
          <span class="percent green">+10%</span>
        </div>

        <div class="metric-card">
          <h3>Retiros Hoy</h3>
          <p class="value">$0.00</p>
          <span class="percent red">-</span>
        </div>
      </div>
    </section>

    <!-- ===== JUEGOS POPULARES ===== -->
    <section class="games-section">
      <h2 class="section-title">Actividad de Juegos Populares</h2>
      <div class="games-card">
        <h3>Juegos Populares</h3>
        <div class="game-row">
          <span>Tragamonedas</span>
          <div class="bar">
            <div class="fill" style="width: 80%;"></div>
          </div>
        </div>
        <div class="game-row">
          <span>Ruleta</span>
          <div class="bar">
            <div class="fill" style="width: 60%;"></div>
          </div>
        </div>
        <div class="game-row">
          <span>Blackjack</span>
          <div class="bar">
            <div class="fill" style="width: 45%;"></div>
          </div>
        </div>
      </div>
    </section>

  </div>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      // Elementos del DOM
      const totalUsersEl = document.querySelector(".metric-card:nth-child(1) .value");
      const activeUsersEl = document.querySelector(".metric-card:nth-child(2) .value");
      const depositsTodayEl = document.querySelector(".metric-card:nth-child(3) .value");
      const withdrawalsTodayEl = document.querySelector(".metric-card:nth-child(4) .value");

      // Verificar sesión de admin usando la utilidad centralizada
      if (!checkAdminAuth()) {
        return; // Si no está autenticado, la función ya redirige
      }

      try {
        const response = await fetch("/api/admin/stats");
        const data = await response.json();

        if (data.error) {
          console.error("Error API:", data.error);
          return;
        }

        // Formateador de moneda
        const formatter = new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN' });

        // Actualizar valores
        if (totalUsersEl) totalUsersEl.textContent = data.total_users || 0;
        if (activeUsersEl) activeUsersEl.textContent = data.active_users || 0;
        if (depositsTodayEl) depositsTodayEl.textContent = formatter.format(data.deposits_today || 0);
        if (withdrawalsTodayEl) withdrawalsTodayEl.textContent = formatter.format(data.withdrawals_today || 0);

      } catch (error) {
        console.error("Error al cargar estadísticas:", error);
      }
    });
  </script>
</body>

</html>