<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mi Cuenta - Configuración</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: #202020;
      color: #ffffff;
      min-height: 100vh;
      padding-bottom: 80px;
    }

    .header {
      display: flex;
      align-items: center;
      padding: 16px 20px;
      background-color: #202020;
      border-bottom: 1px solid #2a2a2a;
    }

    .back-btn {
      font-size: 32px;
      color: #ffffff;
      text-decoration: none;
      margin-right: 16px;
      line-height: 1;
    }

    .header-title {
      font-size: clamp(20px, 5vw, 24px);
      font-weight: 600;
    }

    .container {
      width: 100%;
      max-width: 100%;
      margin: 0 auto;
      padding: 0 16px;
    }

    .subtitle {
      text-align: center;
      font-size: clamp(14px, 4vw, 16px);
      color: #999;
      margin: 24px 0 16px;
    }

    .profile-section {
      display: flex;
      justify-content: center;
      margin: 24px 0;
    }

    .profile-upload {
      width: clamp(100px, 25vw, 140px);
      height: clamp(100px, 25vw, 140px);
    }

    .upload-box {
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #ab925c 0%, #c9a86a 100%);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      overflow: hidden;
      transition: transform 0.2s;
    }

    .upload-box:hover {
      transform: scale(1.05);
    }

    .upload-box img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    #file-input {
      display: none;
    }

    .form {
      width: 100%;
      max-width: 600px;
      margin: 24px auto 0;
    }

    .form input {
      width: 100%;
      padding: clamp(14px, 3.5vw, 18px) clamp(16px, 4vw, 20px);
      margin-bottom: 12px;
      background-color: #ffffff;
      border: none;
      border-radius: 12px;
      font-size: clamp(14px, 3.5vw, 16px);
      color: #000000;
    }

    .form input::placeholder {
      color: #888;
    }

    .form input:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(171, 146, 92, 0.3);
    }

    .btn {
      width: 100%;
      padding: clamp(14px, 3.5vw, 18px);
      border: none;
      border-radius: 12px;
      font-size: clamp(14px, 3.5vw, 16px);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin-bottom: 12px;
    }

    .btn-save {
      background: linear-gradient(135deg, #ab925c 0%, #c9a86a 100%);
      color: #ffffff;
    }

    .btn-save:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(171, 146, 92, 0.4);
    }

    .btn-delete {
      background: linear-gradient(135deg, #c92a2a 0%, #e03131 100%);
      color: #ffffff;
    }

    .btn-delete:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(201, 42, 42, 0.4);
    }

    .rc-nav {
    .nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: #111;
      border-top: 1px solid #b59557;
      right: 0;
      background-color: #202020;
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 10px 0;
      z-index: 100;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
      border-top: 1px solid #2a2a2a;
    }

    .rc-nav-item {
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-decoration: none;
      color: #b59557;
      font-size: 15px;
      transition: color 0.3s, transform 0.2s;
      color: #888;
      transition: color 0.2s;
      padding: 4px 8px;
    }

    .rc-nav-item img {
      width: 28px;
      height: 28px;
      margin-bottom: 5px;
      filter: brightness(0) saturate(100%) invert(77%) sepia(49%) saturate(296%) hue-rotate(5deg) brightness(92%) contrast(91%);
    .nav-item:hover,
    .nav-item.active {
      color: #ab925c;
    }

    .rc-nav-item:hover img {
      filter: brightness(1.3);
      transform: scale(1.1);
    .nav-item img {
      width: clamp(20px, 5vw, 24px);
      height: clamp(20px, 5vw, 24px);
      margin-bottom: 4px;
      filter: grayscale(1) brightness(0.6);
    }

    .rc-nav-item:hover span {
      color: #d8bb76;
      transform: scale(1.05);
    .nav-item:hover img,
    .nav-item.active img {
      filter: grayscale(0) brightness(1);
    }

    @media (min-width: 640px) {
      .container {
        padding: 0 32px;
      }

      .form {
        max-width: 500px;
      }
    }

    @media (min-width: 768px) {
      .container {
        padding: 0 48px;
      }

      .form {
        max-width: 550px;
      }

      body {
        padding-bottom: 70px;
      }
    }

    @media (min-width: 1024px) {
      .container {
        max-width: 800px;
        padding: 0 64px;
      }

      .form {
        max-width: 600px;
      }
    }
  </style>
</head>

<body>

  <div class="header">
    <a href="/account" class="back-btn">‹</a>
    <h1 class="header-title">Mi cuenta</h1>
  </div>

  <div class="container">
    <div class="subtitle">Configuracion</div>

    <div class="profile-section">
      <div class="profile-upload">
        <label for="file-input" class="upload-box">
          <img id="preview" src="{{ url_for('static', path='img/usuario_icon.png') }}" alt="Foto">
        </label>
        <input id="file-input" type="file" accept="image/*">
      </div>
    </div>

    <form class="form" id="profile-form">
      <input type="text" id="usuario" name="usuario" placeholder="Usuario" readonly
        style="background-color: #f0f0f0; cursor: not-allowed;">
      <input type="text" id="nombre" name="nombre" placeholder="Nombre(s)" required>
      <input type="text" id="apellido" name="apellido" placeholder="Apellido(s)" required>
      <input type="email" id="email" name="email" placeholder="Correo" required>
      <input type="password" id="contrasena" name="contrasena" placeholder="Contraseña">
      <input type="text" id="comentario" name="comentario" placeholder="Comentario(opcional)">

      <button type="submit" class="btn btn-save">Guardar Cambios</button>
      <button type="button" class="btn btn-delete">Eliminar Cuenta</button>
    </form>
  </div>

  <nav class="rc-nav">
    <a href="/home" class="rc-nav-item">
  <nav class="nav">
    <a href="/home" class="nav-item">
      <img src="{{ url_for('static', path='img/home_icon.png') }}" alt="Home">
      <span>Inicio</span>
    </a>
    <a href="/games" class="rc-nav-item">
    <a href="/games" class="nav-item">
      <img src="{{ url_for('static', path='img/games_icon.png') }}" alt="Juegos">
      <span>Juegos</span>
    </a>
    <a href="/support" class="rc-nav-item">
    <a href="/support" class="nav-item">
      <img src="{{ url_for('static', path='img/support_icon.png') }}" alt="Soporte">
      <span>Soporte</span>
    </a>
    <a href="/account/cartera" class="rc-nav-item active">
    <a href="/account/cartera" class="nav-item active">
      <img src="{{ url_for('static', path='img/wallet_icon.png') }}" alt="Cartera">
      <span>Cartera</span>
    </a>
  </nav>

  <script>
    document.getElementById('file-input').addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (event) => document.getElementById('preview').src = event.target.result;
        reader.readAsDataURL(file);
      }
    });

    document.addEventListener("DOMContentLoaded", async () => {
      if (localStorage.getItem("userId") && !localStorage.getItem("user_id")) {
        localStorage.setItem("user_id", localStorage.getItem("userId"));
        localStorage.setItem("id_rol", localStorage.getItem("idRol"));
        localStorage.setItem("user_role", localStorage.getItem("userRole"));
        localStorage.removeItem("userId");
        localStorage.removeItem("idRol");
        localStorage.removeItem("userRole");
      }

      const userId = localStorage.getItem("user_id");
      if (!userId) {
        alert("No se ha iniciado sesión");
        window.location.href = "/login";
        return;
      }

      try {
        const response = await fetch(`/api/user/${userId}`);
        if (!response.ok) throw new Error("Error al cargar datos");

        const data = await response.json();
        document.getElementById("usuario").value = `ID: ${data.id_usuario || userId}`;
        document.getElementById("nombre").value = data.nombre || "";
        document.getElementById("apellido").value = data.apellido || "";
        document.getElementById("email").value = data.email || "";
      } catch (error) {
        console.error("Error:", error);
      }

      document.getElementById("profile-form").addEventListener("submit", async (e) => {
        e.preventDefault();

        const formData = new FormData();
        formData.append("nombre", document.getElementById("nombre").value);
        formData.append("apellido", document.getElementById("apellido").value);
        formData.append("email", document.getElementById("email").value);
        if (document.getElementById("contrasena").value) formData.append("contrasena", document.getElementById("contrasena").value);
        if (document.getElementById("comentario").value) formData.append("comentario", document.getElementById("comentario").value);

        try {
          const response = await fetch(`/api/user/update/${userId}`, {
            method: 'PUT',
            body: formData
          });

          const result = await response.json();
          if (!response.ok) throw new Error(result.error || 'Error');

          alert("✅ Perfil actualizado");
          document.getElementById("contrasena").value = "";
        } catch (error) {
          alert("Error: " + error.message);
        }
      });
    });
  </script>

</body>

</html>