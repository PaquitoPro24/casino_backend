<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Balance - Royal Crumbs</title>
  <link rel="stylesheet" href="{{ url_for('static', path='css/account-cartera-balance.css') }}">
</head>

<body>

  <div class="rc-container">
    <!-- ENCABEZADO -->
    <div class="rc-header">
      <a href="/account/cartera" class="rc-back">‹</a>
      <h1 class="rc-screen-title">Balance</h1>
    </div>

    <!-- SECCIÓN SUPERIOR -->
    <section class="balance-top">
      <h2 class="rc-subtitle">Saldo Total</h2>
      <p class="saldo-total" id="saldo-total">Cargando...</p>

      <div class="btn-row">
        <button class="btn-dorado" onclick="window.location.href='/account/cartera/depositos'">Depositar</button>
        <button class="btn-dorado" onclick="window.location.href='/account/cartera/retiros'">Retirar</button>
      </div>
    </section>

    <!-- DISTRIBUCIÓN RESPONSIVA -->
    <div class="balance-layout">

      <!-- IZQUIERDA: PRÉSTAMO -->
      <section class="prestamo-section">
        <h2 class="rc-subtitle">Préstamo</h2>

        <input type="text" class="input-field" placeholder="Introduce un monto">
        <select class="input-field">
          <option>Seleccionar Garantía</option>
          <option>Saldo Principal</option>
          <option>Bonificación</option>
        </select>
        <button class="btn-dorado">Solicitar</button>

        <div class="balance-box">
          <h3>Adeudos</h3>
          <p><strong>Vencimiento:</strong> 30 de Noviembre</p>
          <p>Préstamo de Juego <span class="negativo">- $150.00</span></p>
        </div>
      </section>

      <!-- DERECHA: INFORMACIÓN DE BALANCE -->
      <section class="right-column">

        <div class="balance-box">
          <h3>Detalle del Saldo</h3>
          <div class="detail-row">
            <span>Saldo Principal</span>
            <span id="saldo-principal">Cargando...</span>
          </div>
          <div class="detail-row">
            <span>Saldo de Bonificación</span>
            <span id="saldo-bono">Cargando...</span>
          </div>
        </div>

        <div class="balance-box">
          <h3>Adeudos</h3>
          <p><strong>Vencimiento:</strong> 30 de Noviembre</p>
          <p>Préstamo de Juego <span class="negativo">- $150.00</span></p>
        </div>

        <div class="balance-box">
          <h3>Límite</h3>
          <input type="range" min="10" max="5000" value="2500" class="limite-slider">
          <div class="limite-etiquetas">
            <span>$10.00</span>
            <span>$1000.00</span>
          </div>

          <div class="btn-row">
            <button class="btn-gris">Cambiar Límite</button>
            <button class="btn-dorado">Préstamo</button>
          </div>
        </div>
      </section>

    </div> <!-- balance-layout -->

  </div>

  <!-- NAV INFERIOR -->
  <nav class="rc-nav">
    <a href="/home" class="rc-nav-item">
      <img src="{{ url_for('static', path='img/home_icon.png') }}" alt="Inicio">
      <span>Inicio</span>
    </a>
    <a href="/games" class="rc-nav-item">
      <img src="{{ url_for('static', path='img/games_icon.png') }}" alt="Juegos">
      <span>Juegos</span>
    </a>
    <a href="/support" class="rc-nav-item">
      <img src="{{ url_for('static', path='img/support_icon.png') }}" alt="Soporte">
      <span>Soporte</span>
    </a>
    <a href="/account/cartera" class="rc-nav-item">
      <img src="{{ url_for('static', path='img/wallet_icon.png') }}" alt="Cartera">
      <span>Cartera</span>
    </a>
  </nav>

  <!-- SCRIPT PARA CARGAR SALDO -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const saldoTotalEl = document.getElementById("saldo-total");
      const saldoPrincipalEl = document.getElementById("saldo-principal");
      const saldoBonoEl = document.getElementById("saldo-bono");

      const userId = localStorage.getItem("user_id");

      if (!userId) {
        window.location.href = "/login";
        return;
      }

      // Cargar saldo del usuario
      async function loadBalance() {
        try {
          const response = await fetch(`/api/user/${userId}`);
          if (!response.ok) throw new Error("Error al cargar el saldo");

          const data = await response.json();

          const formatter = new Intl.NumberFormat('es-MX', {
            style: 'currency',
            currency: 'MXN'
          });

          // Saldo Total = Principal + Bono
          const total = data.saldo + data.saldo_bono;

          saldoTotalEl.textContent = formatter.format(total);
          saldoPrincipalEl.textContent = formatter.format(data.saldo);
          saldoBonoEl.textContent = formatter.format(data.saldo_bono);

        } catch (error) {
          console.error("Error:", error);
          saldoTotalEl.textContent = "No disponible";
        }
      }

      loadBalance();
    });
  </script>

</body>

</html>