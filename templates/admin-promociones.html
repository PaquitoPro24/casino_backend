<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crear Promoción — Royal Crumbs</title>
  <link rel="stylesheet" href="{{ url_for('static', path='css/admin-promociones.css') }}">
  <script src="{{ url_for(\'static\', path=\'js/admin-auth.js\') }}"></script>
</head>

<body>
  <div class="rc-container">

    <!-- ===== ENCABEZADO ===== -->
    <header class="rc-header">
      <a href="/admin" class="rc-back">‹</a>
      <h1 class="rc-screen-title">Crear Promoción</h1>
      <div></div>
    </header>

    <!-- ===== FORMULARIO DE PROMOCIÓN ===== -->
    <form class="promo-form" id="promoForm">
      <input type="text" name="nombre_bono" placeholder="Nombre de la Promoción" required>
      <input type="text" name="tipo" placeholder="Tipo de Bono (Ej: Bienvenida)" required>
      <input type="text" name="descripcion" placeholder="Descripción" required>
      <!-- El backend espera fecha_expiracion opcional, por ahora lo dejamos simple o agregamos input date -->
      <input type="date" name="fecha_expiracion" placeholder="Fecha Expiración">

      <!-- Campo oculto para activo=true por defecto -->
      <input type="hidden" name="activo" value="true">

      <button type="submit" class="btn-gold">Crear Promoción</button>
    </form>

    <!-- ===== PROMOCIONES ACTIVAS ===== -->
    <section class="promo-list">
      <h2>Promociones Existentes</h2>
      listContainer.innerHTML = "";
      data.bonos.forEach(bono => {
      const statusClass = bono.activo ? "active" : "inactive"; // Asumimos estilos CSS si existen
      const statusText = bono.activo ? "Activo" : "Inactivo";

      const item = document.createElement("div");
      item.className = "promo-card";
      item.innerHTML = `
      <div class="promo-info">
        <p class="promo-title">${bono.nombre_bono}</p>
        <p class="promo-subtitle">${bono.tipo}</p>
        <small style="color: #ccc;">${bono.descripcion}</small>
      </div>
      <span class="promo-status" style="color: ${bono.activo ? '#4caf50' : '#f44336'}">${statusText}</span>
      `;
      listContainer.appendChild(item);
      });
      } else {
      listContainer.innerHTML = '<p style="text-align: center; color: #aaa;">No hay promociones creadas.</p>';
      }
      } catch (error) {
      console.error(error);
      listContainer.innerHTML = '<p style="text-align: center; color: red;">Error al cargar.</p>';
      }
      }

      // 2. Crear promoción
      promoForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(promoForm);

      // Ajuste para checkbox o valores booleanos si fuera necesario,
      // pero aquí enviamos 'true' fijo en el hidden input.

      try {
      const res = await fetch("/api/admin/bonos", {
      method: "POST",
      body: formData
      });
      const result = await res.json();

      if (result.success) {
      alert("Promoción creada con éxito");
      promoForm.reset();
      loadPromos();
      } else {
      alert("Error: " + (result.error || "Error desconocido"));
      }
      } catch (error) {
      console.error(error);
      alert("Error de conexión");
      }
      });

      loadPromos();
      });
      </script>

  </div>
</body>

</html>