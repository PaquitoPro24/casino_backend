<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Usuarios — Royal Crumbs</title>
  <link rel="stylesheet" href="{{ url_for('static', path='css/admin-usuarios.css') }}">
</head>

<body>
  <div class="rc-container">

    <!-- ===== ENCABEZADO ===== -->
    <header class="rc-header">
      <a href="/admin/gestion-usuarios" class="rc-back">‹</a>
      <h1 class="rc-screen-title">Administradores</h1>
      <div></div>
    </header>

    <!-- ===== BUSCADOR ===== -->
    <div class="search-bar">
      <input type="text" placeholder="Buscar transacciones" />
    </div>

    <!-- ===== LISTA DE USUARIOS ===== -->
    <section class="users-list" id="admins-list-container">
      <p style="text-align: center; color: white;">Cargando administradores...</p>
    </section>

  </div>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const container = document.getElementById("admins-list-container");

      // Verificar admin
      const adminRol = (localStorage.getItem("rol") || "").toLowerCase().trim();
      if (adminRol !== 'administrador' && adminRol !== 'auditor') {
        alert("Acceso denegado.");
        window.location.href = "/login";
        return;
      }

      try {
        const res = await fetch("/api/admin/administradores");
        const data = await res.json();

        if (data.admins && data.admins.length > 0) {
          container.innerHTML = "";
          data.admins.forEach(admin => {
            const item = document.createElement("a");
            item.href = `/admin/usuarios/perfil?id=${admin.id_usuario}`; // Reutilizamos perfil de usuario
            item.className = "user-item";

            item.innerHTML = `
              <div class="user-info">
                <img src="{{ url_for('static', path='img/user-icon-gold.png') }}" alt="Usuario">
                <div>
                  <p class="username">${admin.nombre} ${admin.apellido}</p>
                  <p class="email">${admin.email}</p>
                </div>
              </div>
              <span style="color: #d8bb76; font-weight: bold;">${admin.rol}</span>
            `;
            container.appendChild(item);
          });
        } else {
          container.innerHTML = '<p style="text-align: center; color: #aaa;">No se encontraron administradores.</p>';
        }

      } catch (error) {
        console.error(error);
        container.innerHTML = '<p style="text-align: center; color: red;">Error al cargar.</p>';
      }
    });
  </script>

  </div>
</body>

</html>